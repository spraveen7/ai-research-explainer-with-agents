"""
Command Line Interface for AI Research Topic Explainer
"""
import os
import json
from datetime import datetime
from main_orchestrator import AIResearchOrchestrator

def save_results(result, topic):
    """Save results to a file"""
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"results/{topic.replace(' ', '_')}_{timestamp}.json"
    
    # Create results directory if it doesn't exist
    os.makedirs("results", exist_ok=True)
    
    with open(filename, 'w') as f:
        json.dump(result, f, indent=2)
    
    return filename

def save_study_guide(result, topic):
    """Save study guide to a markdown file"""
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"results/{topic.replace(' ', '_')}_{timestamp}.md"
    
    # Create results directory if it doesn't exist
    os.makedirs("results", exist_ok=True)
    
    with open(filename, 'w') as f:
        f.write(f"# ğŸ“š Study Guide: {topic}\n\n")
        f.write("## ğŸ” Research Summary\n")
        f.write(result['research'] + "\n\n")
        f.write("## ğŸ“ Content Summary\n")
        f.write(result['summary'] + "\n\n")
        f.write("## ğŸ¨ Visual Diagrams\n")
        f.write(result['diagrams'] + "\n\n")
        f.write("## ğŸ“š Educational Materials\n")
        f.write(result['educational_materials'] + "\n\n")
        f.write("---\n")
        f.write("*Generated by 4-Agent AI Research Explainer*\n")
    
    return filename

def display_results(result):
    """Display results in a formatted way"""
    print("\n" + "="*60)
    print("âœ… 4-Agent Research Complete!")
    print("="*60)
    
    print(f"\nğŸ“š Topic: {result['topic']}")
    
    print(f"\nğŸ” Research:")
    print(result['research'][:500] + "..." if len(result['research']) > 500 else result['research'])
    
    print(f"\nğŸ“ Summary:")
    print(result['summary'][:500] + "..." if len(result['summary']) > 500 else result['summary'])
    
    print(f"\nğŸ¨ Diagrams:")
    print(result['diagrams'][:300] + "..." if len(result['diagrams']) > 300 else result['diagrams'])
    
    print(f"\nğŸ“š Educational Materials:")
    print(result['educational_materials'][:500] + "..." if len(result['educational_materials']) > 500 else result['educational_materials'])

def main():
    """Main CLI function"""
    print("ğŸ¤– AI Research Topic Explainer - 4-Agent System")
    print("=" * 60)
    print("This system uses 4 specialized AI agents to research and explain any topic:")
    print("1. ğŸ” Research Agent - Finds information using web search")
    print("2. ğŸ“ Summarizer Agent - Creates structured summaries")
    print("3. ğŸ¨ Visualizer Agent - Creates Mermaid diagrams")
    print("4. ğŸ“š Tutor Agent - Creates educational materials")
    print("=" * 60)
    
    try:
        # Initialize the orchestrator
        print("\nğŸš€ Initializing 4-Agent system...")
        orchestrator = AIResearchOrchestrator()
        
        while True:
            # Get topic from user
            topic = input("\nğŸ” Enter a topic to research (or 'quit' to exit): ").strip()
            
            if topic.lower() in ['quit', 'exit', 'q']:
                print("ğŸ‘‹ Thank you for using AI Research Topic Explainer!")
                break
            
            if not topic:
                print("âŒ Please enter a valid topic.")
                continue
            
            print(f"\nğŸš€ Starting 4-agent research on: {topic}")
            print("â³ This may take a moment as all 4 agents work together...")
            
            try:
                # Run the 4-agent system
                result = orchestrator.explain_topic(topic)
                
                # Display results
                display_results(result)
                
                # Ask if user wants to save results
                save_choice = input("\nğŸ’¾ Save results? (y/n): ").strip().lower()
                if save_choice in ['y', 'yes']:
                    json_file = save_results(result, topic)
                    md_file = save_study_guide(result, topic)
                    print(f"ğŸ“ Results saved:")
                    print(f"   JSON: {json_file}")
                    print(f"   Study Guide: {md_file}")
                
            except Exception as e:
                print(f"âŒ Error during research: {str(e)}")
                print("Please check your API keys and try again.")
    
    except KeyboardInterrupt:
        print("\n\nğŸ‘‹ Goodbye!")
    except Exception as e:
        print(f"âŒ Error initializing system: {str(e)}")
        print("Please check your setup and try again.")

if __name__ == "__main__":
    main()